- name: Clone oh-my-zsh
  git: repo={{oh_my_zsh_repo}} dest={{oh_my_zsh_home}} update=no
  # .zshrc will be generated later by the dotfile entries

- name: Check if oh-my-zsh is customized by us
  stat: path={{oh_my_zsh_home}}/custom/.git
  register: zsh_custom_repo_clone

- name: Delete custom dir if it does not contain our repo
  file: path={{oh_my_zsh_home}}/custom state=absent
  when: oh_my_zsh_custom_repo and not zsh_custom_repo_clone.stat.exists

- name: Checkout oh-my-zsh customizations
  git: repo={{oh_my_zsh_custom_repo}} dest={{oh_my_zsh_home}}/custom
  when: oh_my_zsh_custom_repo